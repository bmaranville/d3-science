<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style>
html, body {
  height: 100%;
  overflow: hidden;
}
svg {
  float: left;
  border-bottom: solid 1px #ccc;
  border-right: solid 1px #ccc;
  margin-right: -1px;
  margin-bottom: -1px;
}
svg .interactors {
  cursor: move;
}

</style>
<body>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="//www.ncnr.nist.gov/instruments/magik/calculators/js/complex.js"></script>
<script src="polygon-interactor.js"></script>
<script>

var width = d3.select("body").node().clientWidth - 50,
    height = d3.select("body").node().clientHeight - 50,
    radius = 5;

var x = d3.scale.linear()
  .domain([0, 10])
  .range([0, width])
  
var y = d3.scale.linear()
  .domain([-1, 9])
  .range([height, 0]);

var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);

var x0 = 5,
    y0 = 5;

var opts1 = { 
      type:'Polygon', 
      name:'roi_polygon',
      color1: '#ff0000',
      color2: '#ff0000',
      fill: "none",
      showcenter: true,
      show: false,
      points: [[0,0], [1,5],[2,5],[3,5], [4,5],[5, 0], [6, 0],[10,0]]
    }

var poly1 = new polygonInteractor(opts1, x, y);
var k1 = Math.PI * 2.0 / 10.0;
var fc = function(k, points) {
  var out = new Complex(0,0);
  for (var i=0; i<points.length-1; i++) {
    var y2 = points[i+1][1],
        x2 = points[i+1][0],
        y1 = points[i][1],
        x1 = points[i][0];
    if (x2 < x1) {
      throw "non-single valued y(x) (x[n+1] < x[n]) for n=" + i;
    }
    else if (x2 == x1) { continue }
    else {
      var m = (y2 - y1) / (x2 - x1);
      var c2 = Complex.add(Complex.multiply(-y2/k, Complex.i), m/(k*k)),
          c1 = Complex.add(Complex.multiply(-y1/k, Complex.i), m/(k*k)),
          a2 = Complex.exp(Complex.multiply(Complex.multiply(Complex.i, k), x2)),
          a1 = Complex.exp(Complex.multiply(Complex.multiply(Complex.i, k), x1)),
          new_out = Complex.subtract(Complex.multiply(a2, c2), Complex.multiply(a1, c1));
      out = Complex.add(new_out, out);
    }
  }
  return out;
}
svg.call(poly1);

var ft = function() {
  ft_out = [];
  for (var i=0; i<12; i++) {
    var ii=i+1;
    var k = Math.PI * 2.0 / 10.0 * ii;
    ft_out[i] = fc(k, poly1.state.points).magsq().toFixed(4);
  }
  console.log((ft_out));
}

poly1.dispatch.on("update", ft);
</script>
</body>
</html>

